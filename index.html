<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIMO SHOP | Neon Evolution</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --neon-blue: #00d2ff; --neon-pink: #bc13fe; --glass: rgba(255, 255, 255, 0.05); --card-border: rgba(255, 255, 255, 0.1); }
        body { margin: 0; background: #050508; color: white; font-family: 'Inter', sans-serif; overflow-x: hidden; background-attachment: fixed; padding-bottom: 80px; }
        
        /* Auth Styles */
        #auth-page { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        .auth-card { background: rgba(255,255,255,0.03); border: 1px solid var(--card-border); padding: 30px; border-radius: 25px; width: 100%; max-width: 350px; backdrop-filter: blur(15px); text-align: center; }
        
        /* Layout Styles */
        .page { display: none; padding: 20px; max-width: 800px; margin: auto; animation: fadeIn 0.4s ease-out; }
        .active-page { display: block !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .wallet-card { background: linear-gradient(135deg, rgba(0, 210, 255, 0.15), rgba(188, 19, 254, 0.15)); border: 1px solid var(--neon-blue); border-radius: 25px; padding: 20px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .balance-amount { font-size: 26px; font-weight: 900; color: var(--neon-blue); }

        /* Admin UI */
        .adm-sec { background: rgba(255,255,255,0.03); border: 1px solid var(--neon-blue); padding: 20px; border-radius: 20px; margin-top: 20px; }
        .admin-input { width: 100%; padding: 12px; margin-bottom: 10px; background: #000; border: 1px solid #444; color: white; border-radius: 12px; box-sizing: border-box; }
        .adm-tab-box { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px; }
        .adm-tab { background: #111; padding: 10px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; border: 1px solid #333; color: #fff; }
        .adm-tab.active { background: var(--neon-blue); color: #000; font-weight: bold; }

        /* Utilities */
        header { display: flex; align-items: center; justify-content: center; margin-bottom: 30px; margin-top: 20px; }
        .k-logo { width: 70px; height: 70px; border-radius: 20px; border: 2px solid var(--neon-blue); overflow: hidden; }
        .k-logo img { width: 100%; height: 100%; object-fit: cover; }
        .shop-title { margin-left: 15px; font-size: 24px; font-weight: 900; color: white; text-transform: uppercase; }
        .buy-pill { background: linear-gradient(90deg, #00c6ff, #0072ff); border: none; color: white; padding: 12px; border-radius: 50px; cursor: pointer; font-weight: bold; }
        .grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .main-card { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 20px; text-align: center; border: 1px solid var(--card-border); cursor: pointer; transition: 0.3s; }
        .main-card:active { transform: scale(0.95); }
        
        /* Drawer Menu */
        .drawer-btn { position: fixed; right: 20px; top: 20px; z-index: 1000; background: #000; border: 1px solid var(--neon-blue); color: white; padding: 8px 15px; border-radius: 10px; cursor: pointer; }
        #d-menu { position: fixed; top: 0; right: -300px; width: 260px; height: 100%; background: #0a0a0f; border-left: 1px solid var(--neon-blue); z-index: 2000; transition: 0.4s; padding: 40px 20px; box-sizing: border-box; }
        #d-menu.open { right: 0; }
        
        .price-item { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="loader" style="position:fixed; width:100%; height:100%; background:#000; z-index:9999; display:flex; justify-content:center; align-items:center;"><h1>KIMO LOADING...</h1></div>

    <div id="auth-page">
        <div class="auth-card" id="login-box">
            <h2 style="color:var(--neon-blue)">KIMO LOGIN</h2>
            <input type="text" id="auth-phone" class="admin-input" placeholder="Phone Number">
            <input type="password" id="auth-pass" class="admin-input" placeholder="Password">
            <button class="buy-pill" style="width:100%" onclick="handleAuth('login')">LOGIN</button>
            <p onclick="toggleAuth()" style="font-size:12px; margin-top:15px; cursor:pointer;">No account? <span style="color:var(--neon-blue)">Register</span></p>
        </div>
        <div class="auth-card" id="reg-box" style="display:none;">
            <h2 style="color:var(--neon-pink)">KIMO REGISTER</h2>
            <input type="text" id="reg-phone" class="admin-input" placeholder="Phone Number">
            <input type="password" id="reg-pass" class="admin-input" placeholder="Password">
            <button class="buy-pill" style="width:100%; background:var(--neon-pink)" onclick="handleAuth('reg')">REGISTER</button>
            <p onclick="toggleAuth()" style="font-size:12px; margin-top:15px; cursor:pointer;">Back to <span style="color:var(--neon-blue)">Login</span></p>
        </div>
    </div>

    <div id="app-content" style="display:none;">
        <button class="drawer-btn" onclick="toggleDrawer()">MENU</button>
        <div id="d-menu">
            <h3 style="color:var(--neon-blue)">KIMO SHOP</h3>
            <div onclick="nav('main-page')" style="padding:15px 0; cursor:pointer;">Home</div>
            <div id="adm-entry" style="display:none; color:var(--neon-pink); padding:15px 0; cursor:pointer;" onclick="nav('admin-page')">ADMIN PANEL</div>
            <div onclick="logout()" style="padding:15px 0; cursor:pointer; color:red;">Logout</div>
        </div>

        <div id="main-page" class="page">
            <header>
                <div class="k-logo"><img id="display-logo" src=""></div>
                <div class="shop-title">KIMO SHOP</div>
            </header>
            <div class="wallet-card">
                <div><div style="font-size:11px; opacity:0.7;">MY BALANCE</div><div class="balance-amount"><span id="user-balance">0</span> MMK</div></div>
                <button class="buy-pill" style="padding:8px 15px;" onclick="nav('topup-page')">+ TOPUP</button>
            </div>
            <div class="grid-layout">
                <div class="main-card" onclick="nav('mlbb-page')"><h3>MLBB</h3></div>
                <div class="main-card" onclick="nav('pubg-page')"><h3>PUBG</h3></div>
                <div class="main-card" onclick="nav('heartopia-page')"><h3>HEARTOPIA</h3></div>
                <div class="main-card" onclick="nav('tg-page')"><h3>TELEGRAM</h3></div>
            </div>
        </div>

        <div id="mlbb-page" class="page"><button onclick="nav('main-page')">BACK</button><h2>MLBB PRICES</h2><div id="list-mlbb"></div></div>
        <div id="pubg-page" class="page"><button onclick="nav('main-page')">BACK</button><h2>PUBG PRICES</h2><div id="list-pubg"></div></div>
        <div id="heartopia-page" class="page"><button onclick="nav('main-page')">BACK</button><h2>HEARTOPIA PRICES</h2><div id="list-heartopia"></div></div>
        <div id="tg-page" class="page"><button onclick="nav('main-page')">BACK</button><h2>TELEGRAM PRICES</h2><div id="list-tg"></div></div>

        <div id="topup-page" class="page">
            <button onclick="nav('main-page')">BACK</button>
            <h2>TOP UP WALLET</h2>
            <div class="adm-sec">
                <p>Kpay No: <b id="top-kp-num">-</b></p>
                <p>Name: <b id="top-kp-name">-</b></p>
                <input type="number" id="topup-amt" class="admin-input" placeholder="Amount">
                <p>Attach Screenshot:</p>
                <input type="file" id="topup-file" class="admin-input">
                <button class="buy-pill" style="width:100%" onclick="submitTopup()">SUBMIT REQUEST</button>
            </div>
        </div>

        <div id="admin-page" class="page">
            <button onclick="nav('main-page')">EXIT ADMIN</button>
            <h2 style="color:var(--neon-pink)">ADMIN PANEL</h2>
            <div class="adm-tab-box">
                <div class="adm-tab active" onclick="switchAdm(this,'requests')">Requests</div>
                <div class="adm-tab" onclick="switchAdm(this,'prices')">Edit Prices</div>
                <div class="adm-tab" onclick="switchAdm(this,'settings')">Site Settings</div>
            </div>

            <div id="adm-requests" class="adm-sec">
                <h4>Pending Topups</h4>
                <div id="admin-req-list"></div>
            </div>

            <div id="adm-prices" class="adm-sec" style="display:none">
                <select id="edit-cat-select" class="admin-input" onchange="renderPriceEdit()">
                    <option value="mlbb">MLBB</option><option value="pubg">PUBG</option>
                    <option value="heartopia">HEARTOPIA</option><option value="tg">TG</option>
                </select>
                <div id="price-edit-list"></div>
                <button class="buy-pill" onclick="addNewPriceRow()">+ Add Item</button>
                <button class="buy-pill" style="background:green; margin-left:10px;" onclick="savePrices()">SAVE PRICES</button>
            </div>

            <div id="adm-settings" class="adm-sec" style="display:none">
                <h4>Site Settings</h4>
                <input type="text" id="set-kp-num" class="admin-input" placeholder="Kpay Number">
                <input type="text" id="set-kp-name" class="admin-input" placeholder="Kpay Name">
                <p>Logo:</p><input type="file" id="set-logo" class="admin-input">
                <p>Background Image:</p><input type="file" id="set-bg" class="admin-input">
                <button class="buy-pill" style="width:100%" onclick="saveSiteSettings()">SAVE SETTINGS</button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://wfvcurswhruefkgtrvcl.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndmdmN1cnN3aHJ1ZWZrZ3RydmNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5ODg3NzQsImV4cCI6MjA4NjU2NDc3NH0.eOR7yiXZi4VK5VtdmN8sh-wZ1loVLVh3EHm7LlRHS5c';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let siteData = { mlbb:[], pubg:[], heartopia:[], tg:[], requests:[], settings:{} };

        // --- AUTH ---
        async function handleAuth(type) {
            const phone = document.getElementById(type==='login'?'auth-phone':'reg-phone').value;
            const pass = document.getElementById(type==='login'?'auth-pass':'reg-pass').value;
            if(!phone || !pass) return alert("Fill all fields");

            if(type === 'reg') {
                const { error } = await _supabase.from('kimo_users').insert({ phone, password: pass, balance: 0 });
                if(error) return alert("Account already exists!");
                alert("Registered! Please login."); toggleAuth();
            } else {
                const { data } = await _supabase.from('kimo_users').select('*').eq('phone', phone).eq('password', pass).single();
                if(!data) return alert("Incorrect login!");
                currentUser = data;
                localStorage.setItem('kimo_user', JSON.stringify(data));
                startApp();
            }
        }

        function toggleAuth() {
            document.getElementById('login-box').style.display = document.getElementById('login-box').style.display==='none'?'block':'none';
            document.getElementById('reg-box').style.display = document.getElementById('reg-box').style.display==='none'?'block':'none';
        }

        async function startApp() {
            document.getElementById('auth-page').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
            if(currentUser.phone === '09123456789' || currentUser.phone === 'kimo1500') {
                document.getElementById('adm-entry').style.display = 'block';
            }
            await refreshData();
            nav('main-page');
        }

        async function refreshData() {
            const { data } = await _supabase.from('kimo_store').select('*');
            data.forEach(row => {
                if(row.category === 'site_settings') siteData.settings = row.content;
                else if(row.category === 'wallet_requests') siteData.requests = row.content;
                else if(siteData[row.category]) siteData[row.category] = row.content;
            });

            const { data: userBal } = await _supabase.from('kimo_users').select('balance').eq('phone', currentUser.phone).single();
            if(userBal) currentUser.balance = userBal.balance;

            renderUI();
        }

        function renderUI() {
            document.getElementById('user-balance').innerText = (currentUser.balance || 0).toLocaleString();
            document.getElementById('top-kp-num').innerText = siteData.settings.kpayNum || '-';
            document.getElementById('top-kp-name').innerText = siteData.settings.kpayName || '-';
            if(siteData.settings.logo) document.getElementById('display-logo').src = siteData.settings.logo;
            if(siteData.settings.bg) document.body.style.backgroundImage = `url(${siteData.settings.bg})`;
            
            ['mlbb','pubg','heartopia','tg'].forEach(cat => {
                const list = document.getElementById('list-'+cat);
                if(list) list.innerHTML = siteData[cat].map(i => `<div class="price-item"><span>${i[0]}</span><button class="buy-pill" style="width:auto">${parseInt(i[1]).toLocaleString()} MMK</button></div>`).join('');
            });
            renderAdminReqs();
        }

        // --- ADMIN ---
        function switchAdm(el, sec) {
            document.querySelectorAll('.adm-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('adm-requests').style.display = sec==='requests'?'block':'none';
            document.getElementById('adm-prices').style.display = sec==='prices'?'block':'none';
            document.getElementById('adm-settings').style.display = sec==='settings'?'block':'none';
            if(sec==='prices') renderPriceEdit();
        }

        function renderPriceEdit() {
            const cat = document.getElementById('edit-cat-select').value;
            const area = document.getElementById('price-edit-list');
            area.innerHTML = siteData[cat].map((item, idx) => `
                <div style="display:flex; gap:5px; margin-bottom:5px;">
                    <input class="admin-input" value="${item[0]}" onchange="siteData['${cat}'][${idx}][0]=this.value">
                    <input class="admin-input" value="${item[1]}" onchange="siteData['${cat}'][${idx}][1]=this.value">
                    <button onclick="siteData['${cat}'].splice(${idx},1);renderPriceEdit()" style="background:red; color:white; border-radius:10px; border:none; padding:5px 10px;">X</button>
                </div>
            `).join('');
        }

        function addNewPriceRow() {
            const cat = document.getElementById('edit-cat-select').value;
            siteData[cat].push(["New Item", "0"]); renderPriceEdit();
        }

        async function savePrices() {
            const cat = document.getElementById('edit-cat-select').value;
            await _supabase.from('kimo_store').upsert({ category: cat, content: siteData[cat] });
            alert("Prices Saved!"); refreshData();
        }

        async function saveSiteSettings() {
            const knum = document.getElementById('set-kp-num').value;
            const kname = document.getElementById('set-kp-name').value;
            const logo = document.getElementById('set-logo').files[0];
            const bg = document.getElementById('set-bg').files[0];

            if(knum) siteData.settings.kpayNum = knum;
            if(kname) siteData.settings.kpayName = kname;
            if(logo) siteData.settings.logo = await toBase64(logo);
            if(bg) siteData.settings.bg = await toBase64(bg);

            await _supabase.from('kimo_store').upsert({ category: 'site_settings', content: siteData.settings });
            alert("Settings Updated!"); location.reload();
        }

        function renderAdminReqs() {
            const list = document.getElementById('admin-req-list');
            list.innerHTML = siteData.requests.map((r, i) => `
                <div class="price-item">
                    <span>${r.phone} (${parseInt(r.amt).toLocaleString()} MMK)</span>
                    <button class="buy-pill" style="background:green" onclick="approveReq(${i})">APPROVE</button>
                </div>
            `).join('') || "No pending requests.";
        }

        async function approveReq(i) {
            const r = siteData.requests[i];
            const { data: u } = await _supabase.from('kimo_users').select('balance').eq('phone', r.phone).single();
            await _supabase.from('kimo_users').update({ balance: (u.balance || 0) + parseInt(r.amt) }).eq('phone', r.phone);
            siteData.requests.splice(i,1);
            await _supabase.from('kimo_store').upsert({ category: 'wallet_requests', content: siteData.requests });
            alert("Topup Approved!"); refreshData();
        }

        // --- HELPERS ---
        function nav(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
            toggleDrawer(false);
        }
        function toggleDrawer(force) {
            const m = document.getElementById('d-menu');
            if(force === false) m.classList.remove('open');
            else m.classList.toggle('open');
        }
        function logout() { localStorage.clear(); location.reload(); }
        function toBase64(file) { return new Promise(res => { const r = new FileReader(); r.onload=e=>res(e.target.result); r.readAsDataURL(file); }); }
        async function submitTopup() {
            const amt = document.getElementById('topup-amt').value;
            if(!amt) return alert("Enter amount");
            siteData.requests.push({ phone: currentUser.phone, amt: amt });
            await _supabase.from('kimo_store').upsert({ category: 'wallet_requests', content: siteData.requests });
            alert("Request sent successfully!"); nav('main-page');
        }

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loader').style.display='none';
                const saved = localStorage.getItem('kimo_user');
                if(saved) { currentUser = JSON.parse(saved); startApp(); }
            }, 1000);
        };
    </script>
</body>
</html>

